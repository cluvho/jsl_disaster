<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<div layout:fragment="content">
	<div class="page-wrapper">
		<div class="main-content">
			<aside class="sidebar">
				<h2 class="sidebar-title">カテゴリー</h2>
				<div class="filter-group">
					<label><input type="checkbox" id="weatherToggle"> 天気情報</label> <label><input
						type="checkbox" id="disasterToggle"> 災害情報</label> <label><input
						type="checkbox" id="shelterToggle"> 避難所情報</label> <label><input
						type="checkbox" id="hospitalToggle"> 病院情報</label>
				</div>
			</aside>

			<main class="content-area">
				<!-- 지도 영역 -->
				<section class="map-section">
					<div id="map" class="map-canvas"></div>
				</section>

				<h2 class="section-title">현재 지역 상세 정보</h2>

				<div class="row g-3">
				  <div class="col-12 col-md-6">
				    <a href="/detail" onclick="goDetail()" class="text-decoration-none">
				      <div class="card h-100 shadow-sm">
				        <div class="card-body d-flex align-items-center gap-3">
				          <div class="fs-2">🗺️</div>
				          <div class="flex-grow-1">
				            <h5 class="card-title mb-1">지역상세정보</h5>
				            <p class="card-text text-muted mb-0">
				              현재 위치에서 가장 가까운 대피소를 확인하고 경로를 안내합니다.
				            </p>
				          </div>
				        </div>
				      </div>
				    </a>
				  </div>
				
				  <div class="col-12 col-md-6">
				    <a href="/guidelines" class="text-decoration-none">
				      <div class="card h-100 shadow-sm">
				        <div class="card-body d-flex align-items-center gap-3">
				          <div class="fs-2">🎒</div>
				          <div class="flex-grow-1">
				            <h5 class="card-title mb-1">상황별 행동 요령</h5>
				            <p class="card-text text-muted mb-0">
				              지진, 태풍, 화재 등 현재 상황에 맞는 행동 요령을 안내합니다.
				            </p>
				          </div>
				        </div>
				      </div>
				    </a>
				  </div>
				</div>
			</main>
		</div>
	</div>
</div>

<th:block layout:fragment="script">
	<script>
		function goDetail() {
		  fetch("/api/me/location")
		    .then(res => res.json())
		    .then(data => {
		      window.location.href = `/detail?lat=${data.lat}&lon=${data.lon}`;
		    })
		    .catch(err => {
		      console.error("위치 가져오기 실패:", err);
		      window.location.href = "/detail?lat=35.681236&lon=139.767125"; // 도쿄
		    });
		}
	</script>
	<script src="/js/cities.js"></script>
	<script src="/js/index/weather.js"></script>
	<script src="/js/index/disaster.js"></script>
	<script
	  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdiJWNOl98gTR6XjCfDhubMwXQZVO3ejs&libraries=geometry&v=weekly&callback=initMap&loading=async "
	  async defer>
	</script>
	<script src="/js/index/myLocation.js"></script>
	<script src="/js/index/shelters.js"></script> <!-- 내 주변 대피소 30개 표시 -->
	<!-- <script src="/js/index/allShelters.js"></script> --> <!-- 모든 대피소 표시 -->
	<script src="/js/index/hospitals.js"></script>
	<script src="/js/index/toggle.js"></script>
</th:block>
</html>
