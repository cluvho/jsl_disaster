<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
      
<head>
    <title data-ko="비밀번호 재설정">パスワード再設定</title>
</head>  

<div layout:fragment="content">
  <div class="auth-wrap">
    <div class="form-card">
      <h2 class="form-title" data-ko="비밀번호 재설정">パスワード再設定</h2>
      
      <div th:if="${success}" class="alert alert-success">
        <span th:text="${success}"></span>
      </div>
      
      <div th:if="${error}" class="alert alert-error">
        <span th:text="${error}"></span>
      </div>
      
      <form method="post" th:action="@{/member/reset-password}" th:if="${!success}">
        <input type="hidden" name="token" th:value="${token}">
        
        <div class="form-field">
          <label for="password" data-ko="새 비밀번호">新しいパスワード</label>
          <input id="password" name="password" type="password" required 
                 minlength="8" placeholder="英語/数字を含め、8文字以上"
                 data-ko-placeholder="영문/숫자 포함, 8자 이상">
        </div>
        
        <div class="form-field">
          <label for="passwordConfirm" data-ko="비밀번호 확인">パスワード確認</label>
          <input id="passwordConfirm" name="passwordConfirm" type="password" required>
          <small id="pwMatchMsg" class="hint" 
                 data-ko-match="비밀번호가 일치합니다." 
                 data-ko-mismatch="비밀번호가 일치하지 않습니다."></small>
        </div>
        
        <button type="submit" class="btn-primary w-100" data-ko="비밀번호 변경">パスワード変更</button>
      </form>
      
      <div class="form-meta" style="text-align: center; margin-top: 15px;">
        <a th:href="@{/member/login}" data-ko="로그인으로 돌아가기">ログインに戻る</a>
      </div>
    </div>
  </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const passwordInput = document.getElementById('password');
        const passwordConfirmInput = document.getElementById('passwordConfirm');
        const msgElement = document.getElementById('pwMatchMsg');

        function validatePassword() {
            const password = passwordInput.value;
            const passwordConfirm = passwordConfirmInput.value;
            
            // 현재 언어 설정을 감지하는 로직 (예시)
            const isKorean = document.documentElement.lang === 'ko';

            if (passwordConfirm && password !== passwordConfirm) {
                // data-ko-mismatch 속성에서 한국어 메시지를 가져오거나, 일본어를 기본값으로 사용
                msgElement.textContent = isKorean ? msgElement.getAttribute('data-ko-mismatch') : 'パスワードが一致しません。';
                msgElement.className = 'hint error';
            } else if (passwordConfirm && password === passwordConfirm) {
                // data-ko-match 속성에서 한국어 메시지를 가져오거나, 일본어를 기본값으로 사용
                msgElement.textContent = isKorean ? msgElement.getAttribute('data-ko-match') : 'パスワードが一致します。';
                msgElement.className = 'hint success';
            } else {
                msgElement.textContent = '';
                msgElement.className = 'hint';
            }
        }
        
        passwordInput.addEventListener('input', validatePassword);
        passwordConfirmInput.addEventListener('input', validatePassword);
    });
    </script>